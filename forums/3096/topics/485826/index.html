<!DOCTYPE html>
<html lang='en'>
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PK63DK');</script>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <meta charset='utf-8'>
    <meta content='width=device-width, initial-scale=1, shrink-to-fit=no' name='viewport'>
    <link crossorigin='anonymous' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css' integrity='sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB' rel='stylesheet'>
    <link href='/styles.css' rel='stylesheet'>
    <title>Java Annotations And Apt</title>
    <script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script><script>var googletag=googletag ||{}; googletag.cmd=googletag.cmd || [];</script><script>googletag.cmd.push(function(){googletag.defineSlot('\/1010898\/sgforums_interstitial', [ 1.0 , 1.0], 'div-gpt-ad-1528181032761-0').setTargeting('forum', ['3096']).setTargeting('topic', ['485826']).addService(googletag.pubads()); googletag.defineSlot('\/1010898\/sgforums_leaderboard', [[ 728.0 , 90.0], [ 970.0 , 250.0]], 'div-gpt-ad-1528181032761-1').setTargeting('forum', ['3096']).setTargeting('topic', ['485826']).addService(googletag.pubads()); googletag.defineSlot('\/1010898\/sgforums_mpu', [ 300.0 , 250.0], 'div-gpt-ad-1528181032761-2').setTargeting('forum', ['3096']).setTargeting('topic', ['485826']).addService(googletag.pubads()); googletag.defineSlot('\/1010898\/sgforums_supersky', [ 160.0 , 600.0], 'div-gpt-ad-1528181032761-3').setTargeting('forum', ['3096']).setTargeting('topic', ['485826']).addService(googletag.pubads()); googletag.pubads().enableSingleRequest(); googletag.enableServices();});</script>
  </head>
  <body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PK63DK"height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div class='container'>
      <a href='/'>Home</a>
      >
      <a href='/forums/3096/'>Programming - Java &amp; C#</a>
      <h1>Java Annotations And Apt</h1>
      <nav class='pagination'>
      </nav>
      <ul class='list-group posts'>
        <li class='list-group-item post'>
          <div class='row'>
            <div class='col-md-2 meta'>
              <div class='author'>The Code</div>
              <time class='date' datetime='2014-07-23T11:06:56+00:00'>23 Jul 14, 11:06</time>
            </div>
            <div class='col-md body'>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 60pt;"><span style="font-family: Calibri;">Java</span></span> <br><span style="line-height: 115%; font-size: 60pt;"><span style="font-family: Calibri;">Annotations and apt</span></span></p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 28pt;"><span style="font-family: Calibri;">Metadata is officially</span></span><br><span style="line-height: 115%; font-size: 28pt;"><span style="font-family: Calibri;">part of the language</span></span></p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 20pt;"><span style="font-family: Calibri;">J.BENTON</span></span></p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 48pt;"><span style="font-family: Calibri;"><span style="line-height: 115%; color: olivedrab; font-size: 48pt;">J</span></span></span>ava developers have long been able to add metadata to code using comment-eating tools such as Javadoc and XDoclet. However, Java 5.0 introduce a language facility called "annotations" that integrates a metadata technology directly into the language, providing a standard for giving attributes to declarations (see JSR-175, (<a href="http://www.jcp.org/en/jsr/detail?id=175">http://www.jcp.org/en/jsr/detail?id=175</a>). To support annotations, Sun Microsystems released apt an "Annotation Processing Tool that lets you write your own annotation processors (<a href="http://java.sun.com/j2se/1.5.0/docs/guide/apt/GettingStarted.html">http://java.sun.com/j2se/1.5.0/docs/guide/apt/GettingStarted.html</a>). This makes it possible for you to build programs that act upon annotations for analyzing Java source files and automatically generating boilerplate code. It does this by providing the mirror API, which provides functionality similar to the reflection API built into the Standard Java libraries. In this article, I examine annotations and show how you use apt to analyze Java source files and generate boilerplate code.</p>
              <p>   You use annotations just as you would any modifying keyword (final, static, transient, and the like), except you put "@" in front of it. Each annotation has a set of intended declaration targets. That is, an annotation is intended to be placed before a package, type (including class, enum, and interface), field (including an enum constant), constructor, method, parameter, local variable declaration, or any combination of these. Three types of annotations exist within Java, each with slightly different syntax. Table 1 describes each type.</p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 18pt;"><span style="font-family: Calibri;">java.lang Annotations</span></span></p>
              <p> </p>
              <p>Syntax always gets clearer as you see examples of real usage. Happily, J2SE 5.0 supplies annotations built into the API to explore. Three are intended to be used by Java compilers and defined in java.lang, so no import is required to use them .</p>
              <p>• @Deprecated. As a standard practice with Java, any declaration that has become obsolete or should not be used for some reason, whether replaced or not, becomes deprecated. Before this annotation, the only way to mark a deprecated declaration was to use Javadoc. This annotation helps compilers and IDEs tell you when you're using a deprecated declaration. It's a marker annotation (no values required). You can use this to annotate any item; see Example 1.</p>
              <p>• @SuppressWarnings. Compilers warn you when your code is syntactically legal but potentially problematic. Sun's javac compiler gives you the ability to turn on warnings using the -Xlint option, which is very much connected with the @SuppressWarnings annotation. However, each compiler can define its own warnings (although there's a request from Sun that compiler writers work to make the warning values compatible).</p>
              <p>   To compile Example 2, you'd enter:</p>
              <p>javac -Xlint:unchecked <br>                              UncheckedExample.java</p>
              <p>   This returns a warning. When you add @SuppressWarnings(value={"unchecked"}) as in Example 3, you get no warning.</p>
              <p>   You can suppress more than one warning by putting more into the value array; for instance, @SuppressWarnings( value={"unchecked", 'finally"}). Table 2 lists the possible options that can be given to -Xlint (given to javac in the form of -Xlint:&lt;option&gt;). If you give no options to -Xlint, it enables all warnings. You can also disable warnings through -Xlint by doing -Xlint:-&lt;option&gt;. Again, including the extra minus disables a warning.</p>
              <p>• @Override. If you think you're overriding a method, use the @Override annotation, which lets the compiler catch the common problem of thinking you're overriding something when you aren't. This is especially useful to keep track of class hierarchy. For instance, if I try to implement java.util.Collection, then try to override the method Object get(int index), I get a compiler error. If I neglected to use the annotation, the compiler would just think I'm creating a new method. Example 4 fails to compile because the List interface - not the Collection interface - defines get(). List extends Collection, which is occasionally a source of confusion for those who are used to exclusively using Lists.</p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 18pt;"><span style="font-family: Calibri;">Meta Annotations</span></span></p>
              <p> </p>
              <p>An annotation type defines annotations, just as an interface defines an object. In fact, annotation types exist as interfaces and act like them in some respects. They automatically extend the java.lang.annotation. Annotation interface and have methods with return types. Their methods can only return primitive types, strings, enums, another annotations, and arrays of those things.</p>
              <p>   In addition to the three previous annotation classes in the java.lang package, four are defined in java.lang.annotation. All the annotations in that package are meta annotations- annotations that annotate annotation types.</p>
              <p>• @Retention. Annotations can have one of three retention policies in Java 5.0. Annotations having "source" retention (RetentionPolicy.SOURCE) exist only in source code and don't get compiled into bytecode. Annotations with "class" retention (RetentionPolicy.CLASS) are intended to be read at the bytecode level, after compilation and before runtime. Finally, runtime retention (RetentionPolicy. RUNTIME) indicates that an annotation can be accessed through reflection at runtime. I focus on annotations with "source" retention because apt is a source-level processing tool.</p>
              <p>• @Target. I previously described the type of targets. You can specify a single target using a single value or multiple ones using an array. Also, giving an empty array to an annotation of this type holds special value. It forces you to use annotation types only as a return type within other annotation types. The apt examples show why this is sometimes necessary when you want multiple annotations of the same type to be given on a single item.</p>
              <p>• @Documented. The @Documented meta annotation is intended for use by document-generation tools like javadoc. Javadoc generates documentation for an annotation type if, and only if, this meta annotation is applied to it.</p>
              <p>• @Inherited. As meta annotations go, @Inherited probably ranks as the most interesting (although it is also excluded from the apt examples for simplicity). It lets annotations be inherited by subclasses of the annotated class. If an annotation type uses this meta annotation, any type (including classes, interfaces, and enums) that it annotates lets this annotation be inherited to its subtypes. This is an "if and only if" condition - if you don't want subtypes to inherit this annotation, then don't use it. (Annotations are inherited on the annotation types themselves. Overridden methods will not inherit annotations.)</p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 18pt;"><span style="font-family: Calibri;">Boilerplate Code and apt</span></span></p>
              <p> </p>
              <p>In their short history, Java annotations have become widely known to be useful for generating boilerplate code. I present an example of this by showing an annotation processor using apt. The apt annotation processor generates new exception classes based upon an annotation given to a type. The exception is slightly different depending upon the values given to the annotation. Listing One contains one of two annotation types required for this example.</p>
              <p>   Annotations give the "default" keyword a second meaning (the first being the "default case" in the switch statement). You use it in annotation type definitions to specify the default value that a method in an annotation returns if the value is not specified.</p>
              <p>   In Listing One, ©Target contains an empty array. The Java compiler won't let you use the same annotation type more than once on the same item. To get around this, you have to create an annotation that takes an array of ApplicationException annotations as its value. The only way you can use an annotation without a target is within another annotation, so defining an annotation in this way ensures proper semantics for the annotation processor. Listing Two shows ApplicationExceptions, the annotation type containing an array of ApplicationException. ApplicationExceptions targets types.</p>
              <p>   The real power of apt comes from the way it processes annotations in Java source files. The tool uses annotations to:</p>
              <p>• Zero in on the flles it needs to process.</p>
              <p>• Analyze the files appropriately and produce boilerplate code or external configuration files.</p>
              <p>   When apt generates a source file, it processes and compiles it in turn. ApplicationExceptionsApf. java (available electronically; <a href="http://www.ddj.com">http://www.ddj.com</a>) shows the annotation processor factory and class for creating the boilerplate code based upon the ApplicationExceptions annotation. Notice the structure of the factory class: It extends com.sun.mirror.apt.AnnotationProcessorFactory and overrides "AnnotationProcessor getProcessorFor (Set, AnnotationProcessorEnvironment)". You give a list of annotations that the factory in ApplicationExceptionsApf.java has processors to handle with the variable supportedAnnotations. The provided list can sometimes look like Java's import facility, but don't be fooled - it acts differently. Unlike package imports, com.ddj.annotations.* means all annotations defined in the package com.ddj.annotations and all of its subpackages. Also, you can specify "*" to mean all annotations can be supported by this factory (this has sort of a double meaning, as it denotes this annotation processor can process any file - even ones containing no annotations). If you want to define more than one package, include them in the array.</p>
              <p>   You can also define your own, userdefined options for annotation processors. To do this, you let the method supportedOptions() return a collection of options beginning with -A. For instance, say you want the processor to have the ability to override the additional information given in the example, so you add -AlgnoreAddedlnfo as a supported option. The list only adds the convenience of checking the "supported options" against the options provided to apt. All of apt's own options and those starting with an -A, whether supported or not, get passed to the processor through environment.</p>
              <p>   In the example, the method getFactoryFor() works in a straightforward manner. It checks that the given supported options match those given to apt. After that, it goes through the annotations that apt has found that the annotation processor also claims to support (given through the atds set). Once it finds com.ddj.annotationsApplicationExceptions, it returns the proper annotation processor. If it fails to find the suitable annotation, it returns a NO_OP annotation. Use NO_OP whenever you want to return an annotation processor that does nothing.</p>
              <p>   Also in ApplicationExceptionsApf.java is the annotation processor itself. It goes into the processor factory class as a static inner class. If you're familiar with Java reflection, you recognize the methods used to analyze the code. Sun's mirror API works much like reflection, except it refers to source code rather than loaded classes and, therefore, works on types and declarations. Table 3 shows each package in the mirror API and a short description of each.</p>
              <p>   The processor is simple. It first looks at each type declaration given to the apt environment. It then gets the ApplicationExceptions annotation and processes each ApplicationException value within, generating a .java file containing the appropriate exception definition.</p>
              <p>   Next, you'll need to use this annotation processor. apt provides two ways of doing this: You can either use apt's built-in annotation processor factory discovery facility, or specify the processor on a command line. You'd use the discovery procedure when you have more than one annotation processor factory. Because only one annotation processor factory exists here, I stick to the command line. You can use the discovery procedure by putting a file called "META-INF/services/com.sun.mirror.apt.AnnotationProcessorFactory" in a .jar file that lists each annotation processor factory that you created. The .jar file also needs to contain all factories listed and their processors. You then can put the .jar me in your class path and apt tries to choose the proper factory for each .java file you're processing, based upon supported annotations you list within each factory.</p>
              <p>   Listing Three is an example of using the ApplicationExceptions class. Again, I use a command-line option to generate and execute the annotation processor. Before executing the following command, make sure the tools.jar file is in your classpath and that you've compiled the annotation processor factory:</p>
              <p>apt - factory com.ddj.apt.processors.<br>    ApplicationExceptionsApf corn\ddj\ * .java</p>
              <p>   This should have generated two files: TestException.java contains an extra integer and AppException.java exists as a plain extension to Exception.</p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 18pt;"><span style="font-family: Calibri;">Conclusion</span></span></p>
              <p> </p>
              <p>In this article, I introduced the annotations built into J2SE 5.0 and looked at how you can use apt to generate boilerplate exception code. I encourage you to expand upon the code. It's important to note, however, that apt's days may be numbered. The recently approved JSR-269, the Pluggable Annotation Processing API, expressly states that it is intended to supersede Sun's mirror API and apt. If it stays on schedule, it will likely ship with Java 6.0 (codenamed "Mustang").</p>
              <p><br>/** Deprecating a method using the annotation. @author J. Benton */<br>public class DeprecateExample {<br>   //if you use this method, you'll get a warning that it is deprecated.<br>@Deprecated<br>public void ohNoIAmDeprecated() {<br>System.out.printIn("I am deprecated!");</p>
              <p>     }</p>
              <p>   }</p>
              <p><strong>Example 1:</strong> Deprecating a method using annotation.</p>
              <p><br>   import java.util.ArrayList;<br>   /** Suppressing warnings. @author J. Benton */<br>   public class UncheckedExample {<br>    public void uncheckedGenerics() {<br>     ArrayList blahblah = new ArrayList();<br>     // warning, warning, warning!! unchecked call below!<br>     blahblah.add(2);<br>     }<br>   }</p>
              <p><strong>Example 2:</strong> Generating a warning.</p>
              <p><br>   import java.util.ArrayList;<br>   <br>   /** Suppressing warnings. @author J. Benton */<br>   // You can use so-called single-valued annotations<br>   // just like regular annotations if you want (note<br>   // how I am specifying the method name here, though<br>   // it is unnecessary) .<br>   @SuppressWarnings(value={"unchecked"})<br>   public class UncheckedExample {<br>    public void uncheckedGenerics() {<br>     ArrayList blahblah = new ArrayList();<br>   // no warning! I suppressed it!<br>blahblah.add(2);</p>
              <p>    }<br>  }</p>
              <p><strong>Example 3:</strong> Using the @Suppress Warnings annotation.</p>
              <p><br><strong>Annotation       Description                     Example Syntax</strong></p>
              <p>Marker             Takes no values                     @MarkerAnnotation<br>Single valued  Takes one value                     @ SingleValuedAnnotation("VALUE")<br>Regular            Takes more than one value   @ RegularAnnotation(name="John Q.", bugValue=1)</p>
              <p><strong>Table 1:</strong> Annotations get addressed differently depending upon the number of values they take.</p>
              <p><strong>Options              Description</strong></p>
              <p>none               Give no warnings.<br>unchecked     Give details on unchecked conversions of types.<br>path                Check for a nonexistent path in environment paths (such as classpath).<br>serial              Check that a serialVersionUID is given in serializable classes.<br>finally              Check that finally classes can be completed normally.<br>fallthrough      Make sure you break after each case statement that would otherwise fall through to the next case statement in a switch</p>
              <p>depreciation Check for use of depreciated items.</p>
              <p><strong>Table 2:</strong> Options that can be given the -XIint in javac.</p>
              <p><br>com.sun.mirror.apt                 Provides classes that interact directly with the tool and its data.<br>com.sun.mirror.declaration   Defines interfaces to declarations.<br>com.sun.mirror.type               Defines interfaces to types defined within the source code.<br>com.sun.mirror.util                  Contains utilities for processing types and declarations.</p>
              <p><strong>Table 3:</strong> Descriptions of the apt mirror API.</p>
              <p><br>   package com.ddj;<br>   import java.util.*;</p>
              <p>   /** Using the ®Override annotation. @author J. Benton */<br>   public class OverrideExample implements Collection {<br>   // ...<br>   /** This won't work! I'm not overriding anything here! <br>    * This is a new method--not one being overridden.<br>    * @param index The index of the thing to get. <br>    * @see java.util.List#get(int) <br>    */<br>   @Override<br>   public Object get(int index) {<br>     Object value = null;<br>     // code to get stuff.<br>     return value;<br>   }<br>   // ...<br> }</p>
              <p><strong>Example 4:</strong> Using the @Override annotation.</p>
              <p> </p>
              <p><strong>Listing One</strong></p>
              <p>   /* ApplicationException.java * Created on Jan 2, 2ØØ5 */</p>
              <p>   package com.ddj.annotations;</p>
              <p>   import java .lang. annotation.*:</p>
              <p>   /** This annotation is used by the annotation processing tool (apt)</p>
              <p>   * to generate an exception. * @author J. Benton */</p>
              <p>   @Retention(RetentionPolicy, SOURCE)</p>
              <p>   // I give an empty array to "@Target"" to say that this annotation<br>   // type should be used only as an element of other annotations<br>   // (you cannot use this to annotate anything directly).</p>
              <p>   @Target ( { } )</p>
              <p>   public @interface ApplicationException {</p>
              <p>     /** What I want to call this exception (sans the word "Exception".*/</p>
              <p>   String exceptionName();</p>
              <p>    /** I must add extra information to this exception to make it useful. */</p>
              <p>   String addedinformationType() default "";</p>
              <p>    /** I should call this extra information something that is recongizable if</p>
              <p>     * you try to read the generated exception class. */</p>
              <p>   String addedInformationVariableName() default "";<br> }</p>
              <p><br><strong>Listing Two</strong></p>
              <p>   /* ApplicationExceptions.java * Created on Jan 2, 2ØØ5 */</p>
              <p>   package com.ddj.annotations;</p>
              <p>   import java.lang.annotation.*;</p>
              <p>   /** This was made so I can generate a set of exceptions for an application</p>
              <p>    * on the main application class. * @author J. Benton */</p>
              <p>   @Target (ElementType.TYPE)</p>
              <p>   @Retention (RetentionPolicy.SOURCE)</p>
              <p>   @Documented</p>
              <p> public @interface ApplicationExceptions {</p>
              <p> /** An array of ApplicationExceptions. I do things this way because we can 1t<br>  <br>  * have more than one instance of the same annotation type on any item. */</p>
              <p>   ApplicationException[] applicationExceptions();</p>
              <p> }</p>
              <p><br><strong>Listing Three</strong></p>
              <p>   /* ExceptionAnnotationTest.java * Created on Jan 3, 2ØØ5 */</p>
              <p>   package com.ddj;</p>
              <p>   import com.ddj.annotations.*;</p>
              <p>   /** Use this to test the annotations. * @author J. Benton */</p>
              <p>   @ApplicationExceptions {</p>
              <p>     applicationExceptions={@ApplicationException ( exceptionName="Test",</p>
              <p>        addedinformationType="int";</p>
              <p>        addedinformationVariableName="status"),</p>
              <p>     @ApplicationException (exceptionName="App")})</p>
              <p>   public class ExceptionAnnotationTest{</p>
              <p>   }</p>
              <p> </p>
              <p><span style="line-height: 115%; font-size: 20pt;"><span style="font-family: Calibri;"><span style="color: #6b8e23;">"An annotation type defines annotations, just as an interface defines an object"</span></span></span></p>
              <p> </p>
              <p>J. Benton is a professional Java programmer and computer science graduate student with research interest in AI planning. He can be reached at <a href="mailto:j.benton@acm.org">j.benton@acm.org</a>.</p>
              <p> </p>
              <p>Dr Dobb's Journal, #374 July 2005, Pg 31-37 </p>
            </div>
          </div>
        </li>
        <li class='list-group-item'>
          <div id='div-gpt-ad-1528181032761-2' style='height:250px; width:300px;'><script>googletag.cmd.push(function(){googletag.display('div-gpt-ad-1528181032761-2');});</script></div>
        </li>
      </ul>
      <nav class='pagination'>
      </nav>
      <footer>
        <nav class='nav'>
          <a class='nav-link' href='/'>Home</a>
          <a class='nav-link' href='/privacy/'>Privacy</a>
          <a class='nav-link' href='/terms/'>Terms</a>
        </nav>
      </footer>
    </div>
    <div id='div-gpt-ad-1528181032761-0' style='height:1px; width:1px;'><script>googletag.cmd.push(function(){googletag.display('div-gpt-ad-1528181032761-0');});</script></div>
  </body>
</html>
